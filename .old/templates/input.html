<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Notenrechner</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='jquery-ui.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script type=text/javascript src="{{ url_for('static', filename='jquery-1.12.4.js') }}"></script>
  <script type=text/javascript src="{{ url_for('static', filename='jquery-ui.js') }}"></script>
  <script>
    $( function() {
      var aufgabenCounter = 3;
      var klausurCounter = 0;
      for (i=0; i<aufgabenCounter; i++){
        input = document.createElement("input")
        $(input).attr("id", encode(-1, i))
        $(input).attr("name", encode(-1, i))
        $( ".maxpoints" ).append(input)
      }
      if (klausurCounter == 0){ add() }
      function add() {
          klausurCounter += 1
          newdiv = document.createElement("div");
          para = document.createElement("p")
          $(newdiv).addClass("klausur ui-widget-content ui-corner-all");
          $(newdiv).append("<h3 class='ui-widget-header ui-corner-all'>Klausur " + klausurCounter + "</h3>")
          for (i=0; i<aufgabenCounter; i++){
            input = document.createElement("input")
            $(input).attr("id", encode(klausurCounter-1, i))
            $(input).attr("name", encode(klausurCounter-1, i))
            $(para).append(input)
          }
          plusbutton = document.createElement("button")
          minusbutton = document.createElement("button")
          $(plusbutton).addClass("button-plus")
          $(minusbutton).addClass("button-minus")
          $(plusbutton).button({icon: "ui-icon-plus"})
          $(minusbutton).button({icon: "ui-icon-minus"})
          $(plusbutton).attr("type", "button")
          $(minusbutton).attr("type", "button")
          $(para).append(plusbutton);
          $(para).append(minusbutton);
          $(newdiv).append(para)
          $(".klausuren").append(newdiv)
      }
      function remove(me) {
          if (klausurCounter > 1) {
            klausurCounter -= 1
            me.parents(".klausur").remove()
            renumber()
          }
      }
      function encode(klausur, aufgabe){
        return (klausur+1).toString() + "/" + (aufgabe+1).toString()
      }
      function renumber() {
        $( ".klausur" ).each(
          function(klausur) {
            $( this ).children("h3").html("Klausur " + (klausur+1))
            $( this ).children("input").each(
              function(aufgabe){ $( this ).attr("id", encode(klausur, aufgabe)) }
            )
          }
        )
      }
      function addAufgabe() {
        input = document.createElement("input")
        $( input ).insertAfter($( ".maxpoints" ).children("input").last())
        $( ".klausur" ).each(
          function(){
            input = document.createElement("input")
            $( input ).insertAfter($( this ).children().children("input").last())
          }
        )
      }
      function removeAufgabe() {
        $( ".maxpoints" ).children("input").last().remove()
        $( ".klausur" ).each(
          function(){
            $( this ).children().children("input").last().remove()
          }
        )
      }
      function submit() {
        max_points = []
        for (i=0; i<aufgabenCounter; i++){
          max_points[i+1] = $("#0\\/" + (i+1).toString() ).val()
        }
        klausuren = {}
        for (i=0; i<klausurCounter; i++){
          klausur = []
          for (j=0; i<aufgabenCounter; j++){
            klausur[j+1] = $("#" + (i+1) + "\\/" + (j+1).toString() ).val()
          }
          klausuren.append(klausur)
        }
        console.log({max_points, klausuren})
      }
      $( ".klausuren" ).on( "click", ".button-plus", add )
      $( ".klausuren" ).on( "click", ".button-minus", function() {
        remove($( this ));
      } )
      $( "#aufgaben" ).on( "change", function(){
        aufgabenCounterOld = aufgabenCounter
        aufgabenCounter = $("#aufgaben").val()
        if (aufgabenCounter > aufgabenCounterOld) {
          for (i=0; i<aufgabenCounter-aufgabenCounterOld; i++){
            addAufgabe()
          }
        } else {
          for (i=0; i<aufgabenCounterOld-aufgabenCounter; i++){
            removeAufgabe()
          }
        }
        renumber()
      } )
    } )
  </script>
</head>
<body>

<form action="evaluate" method="post">
<div class="control">
  <div class ="ui-widget-content ui-corner-all">
    <h3 class='ui-widget-header ui-corner-all'>Steuerung</h3>
    <p>
      <label for="aufgaben">Anzahl Aufgaben</label>
      <input id="aufgaben" type="number" min=1 value=3></input>
      <button id="start" class="button ui-state-default ui-corner-all">Klausur auswerten</button>
    </p>
    <p class="maxpoints">
    </p>
  </div>
</div>

<div class="klausuren">
</div>
</form>

</body>
</html>
